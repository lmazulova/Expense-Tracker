import Foundation

@Observable
final class TransactionsService {
    static let shared: TransactionsService = TransactionsService()
    
    private init() {
    }
    
    private(set) var allTransactions: Set<Transaction> = [
        Transaction(
            id: 1,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1000.00,
                currency: .rub
            ),
            category: Category(
                id: 2,
                name: "–ó–∞—Ä–ø–ª–∞—Ç–∞",
                emoji: "üí∞",
                direction: .income
            ),
            amount: Decimal(string: "1234.56")!,
            transactionDate: Date(),
            comment: "–û–±–µ–¥ —Å –∫–æ–º–∞–Ω–¥–æ–π",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-10T12:05:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-10T12:10:00Z")!
        ),
        Transaction(
            id: 140,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1300.50,
                currency: .rub
            ),
            category: Category(
                id: 5,
                name: "–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞",
                emoji: "üíµ",
                direction: .income
            ),
            amount: Decimal(string: "1234.56")!,
            transactionDate: Date(),
            comment: "–û–±–µ–¥ —Å –∫–æ–º–∞–Ω–¥–æ–π",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-10T12:05:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-10T12:10:00Z")!
        ),
        Transaction(
            id: 2,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1000.00,
                currency: .rub
            ),
            category: Category(
                id: 2,
                name: "–ó–∞—Ä–ø–ª–∞—Ç–∞",
                emoji: "üí∞",
                direction: .income
            ),
            amount: Decimal(string: "4999.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -7, to: Date())!,
            comment: "–ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ –º–∞–π",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-09T09:31:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-09T09:32:00Z")!
        ),
        Transaction(
            id: 3,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1000.00,
                currency: .rub
            ),
            category: Category(
                id: 2,
                name: "–ó–∞—Ä–ø–ª–∞—Ç–∞",
                emoji: "üí∞",
                direction: .income
            ),
            amount: Decimal(string: "199.99")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -3, to: Date())!,
            comment: "–ü–æ–∫—É–ø–∫–∞ –∏–≥—Ä—ã –≤ Steam",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-08T18:46:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-08T18:46:00Z")!
        ),
        Transaction(
            id: 4,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1000.00,
                currency: .rub
            ),
            category: Category(
                id: 2,
                name: "–ó–∞—Ä–ø–ª–∞—Ç–∞",
                emoji: "üí∞",
                direction: .income
            ),
            amount: Decimal(string: "75.50")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -1, to: Date())!,
            comment: "–¢–∞–∫—Å–∏ –¥–æ –æ—Ñ–∏—Å–∞",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-07T08:16:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-07T08:17:00Z")!
        ),
        Transaction(
            id: 5,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 1000.00,
                currency: .rub
            ),
            category: Category(
                id: 7,
                name: "–ö—ç—à–±–µ–∫",
                emoji: "üí∏",
                direction: .income
            ),
            amount: Decimal(string: "250.00")!,
            transactionDate: Date(),
            comment: nil,
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 6,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 800.00,
                currency: .rub
            ),
            category: Category(
                id: 8,
                name: "–ü—Ä–æ–¥—É–∫—Ç—ã",
                emoji: "üõí",
                direction: .outcome
            ),
            amount: Decimal(string: "-350.75")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -2, to: Date())!,
            comment: "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–µ",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-06T15:20:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-06T15:21:00Z")!
        ),
        Transaction(
            id: 7,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 600.00,
                currency: .rub
            ),
            category: Category(
                id: 1,
                name: "–ï–¥–∞",
                emoji: "üçî",
                direction: .outcome
            ),
            amount: Decimal(string: "-120.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -1, to: Date())!,
            comment: "–ö–æ—Ñ–µ —Å –¥—Ä—É–∑—å—è–º–∏",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-07T10:00:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-07T10:01:00Z")!
        ),
        Transaction(
            id: 8,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 500.00,
                currency: .rub
            ),
            category: Category(
                id: 3,
                name: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
                emoji: "üöå",
                direction: .outcome
            ),
            amount: Decimal(string: "-50.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -5, to: Date())!,
            comment: "–ú–µ—Ç—Ä–æ",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-03T08:30:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-03T08:31:00Z")!
        ),
        Transaction(
            id: 9,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 450.00,
                currency: .rub
            ),
            category: Category(
                id: 4,
                name: "–ú–µ–¥–∏—Ü–∏–Ω–∞ ",
                emoji: "üíä",
                direction: .outcome
            ),
            amount: Decimal(string: "-200.00")!,
            transactionDate: Date(),
            comment: "–ü–æ–∫—É–ø–∫–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 10,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 400.00,
                currency: .rub
            ),
            category: Category(
                id: 6,
                name: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
                emoji: "üíÉ",
                direction: .outcome
            ),
            amount: Decimal(string: "-150.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -4, to: Date())!,
            comment: "–ö–∏–Ω–æ",
            createdAt: ISO8601DateFormatter().date(from: "2025-06-04T20:00:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-06-04T20:01:00Z")!
        ),
        Transaction(
            id: 11,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 300.00,
                currency: .rub
            ),
            category: Category(
                id: 9,
                name: "–î–æ–º",
                emoji: "üè†",
                direction: .outcome
            ),
            amount: Decimal(string: "-100.00")!,
            transactionDate: Date(),
            comment: "–ü–æ–∫—É–ø–∫–∞ –±—ã—Ç–æ–≤–æ–π —Ö–∏–º–∏–∏",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 12,
            account: BankAccount(
                id: 1,
                name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç",
                balance: 250.00,
                currency: .rub
            ),
            category: Category(
                id: 10,
                name: "–ü–æ–¥–∞—Ä–∫–∏",
                emoji: "üéÅ",
                direction: .outcome
            ),
            amount: Decimal(string: "-50.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -10, to: Date())!,
            comment: "–ü–æ–¥–∞—Ä–æ–∫ –¥—Ä—É–≥—É",
            createdAt: ISO8601DateFormatter().date(from: "2025-05-30T18:00:00Z")!,
            updatedAt: ISO8601DateFormatter().date(from: "2025-05-30T18:01:00Z")!
        ),
        Transaction(
            id: 13,
            account: BankAccount(id: 100, name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç", balance: 200.00, currency: .rub),
            category: Category(
                id: 9,
                name: "–î–æ–º",
                emoji: "üè†",
                direction: .outcome
            ),
            amount: Decimal(string: "-80.00")!,
            transactionDate: Date(), // today
            comment: "–ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 14,
            account: BankAccount(id: 100, name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç", balance: 120.00, currency: .rub),
            category: Category(
                id: 3,
                name: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
                emoji: "üöå",
                direction: .outcome
            ),
            amount: Decimal(string: "-150.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -3, to: Date())!,
            comment: "–ü–æ–µ–∑–¥–∫–∞ –Ω–∞ —Ç–∞–∫—Å–∏",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 15,
            account: BankAccount(id: 100, name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç", balance: 70.00, currency: .rub),
            category: Category(
                id: 10,
                name: "–ü–æ–¥–∞—Ä–∫–∏",
                emoji: "üéÅ",
                direction: .outcome
            ),
            amount: Decimal(string: "-300.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -7, to: Date())!,
            comment: "–ü–æ–∫—É–ø–∫–∞ —Ñ—É—Ç–±–æ–ª–∫–∏",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 16,
            account: BankAccount(id: 100, name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç", balance: 50.00, currency: .rub),
            category: Category(
                id: 10,
                name: "–ü–æ–¥–∞—Ä–∫–∏",
                emoji: "üéÅ",
                direction: .outcome
            ),
            amount: Decimal(string: "-60.00")!,
            transactionDate: Date(),
            comment: "–ö—Ä–µ–º –¥–ª—è –ª–∏—Ü–∞",
            createdAt: Date(),
            updatedAt: Date()
        ),
        Transaction(
            id: 17,
            account: BankAccount(id: 100, name: "–û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç", balance: 30.00, currency: .rub),
            category: Category(
                id: 11,
                name: "–°–≤—è–∑—å",
                emoji: "üì±",
                direction: .outcome
            ),
            amount: Decimal(string: "-20.00")!,
            transactionDate: Calendar.current.date(byAdding: .day, value: -1, to: Date())!,
            comment: "–û–ø–ª–∞—Ç–∞ –º–æ–±–∏–ª—å–Ω–æ–π —Å–≤—è–∑–∏",
            createdAt: Date(),
            updatedAt: Date()
        )
    ]
    
    func getTransactions(from startDate: Date, to endDate: Date) async throws -> [Transaction] {
        allTransactions.filter { $0.transactionDate >= startDate && $0.transactionDate <= endDate }
    }
    
    func createTransaction(_ transaction: Transaction) async throws {
        guard !allTransactions.contains(where: { $0.id == transaction.id }) else { return }
        allTransactions.insert(transaction)
    }
    
    func editTransaction(_ editedTransaction: Transaction) async throws {
        guard let transaction = allTransactions.first(where: { $0.id == editedTransaction.id }) else { return }
        allTransactions.remove(transaction)
        allTransactions.insert(editedTransaction)
    }
    
    func deleteTransaction(byId id: Int) async throws {
        guard let transaction = allTransactions.first(where: { $0.id == id }) else { return }
        allTransactions.remove(transaction)
    }
}
